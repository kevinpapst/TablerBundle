{# Options #}
{% set _id                  = id ?? uniqueId('box_') %}
{% set _boxtype             = boxtype ?? null %}
{% set _fullsize            = fullsize ?? false %}
{% set _margin_bottom       = margin_bottom ?? 3 %}
{% set _status_position     = status_position ?? 'top' %}
{% set _collapsed           = collapsed ?? false %}
{% set _collapsible         = collapsible ?? _collapsed %}
{% set _use_footer          = use_footer ?? false %}
{% set _footer_collapsible  = footer_collapsible ?? true %}

{# Blocks definition #}
{% set _title               = block('box_title') is defined and block('box_title') is not empty ? block('box_title') : null %}
{% set _tools               = block('box_tools') is defined and block('box_tools') is not empty ? block('box_tools') : null %}
{% set _header              = block('box_header') is defined and block('box_header') is not empty ? block('box_header') : null %}

{# Blocks conditions #}
{% set _footer              = _use_footer or (block('box_footer') is defined and block('box_footer') is not empty) %}

{# *** Internal : do not mind *** #}
{% set _collapsible_class   = uniqueId('collapse_') %}
{# ****************************** #}

{% import '@Tabler/components/buttons.html.twig' as button %}

{% block box_before %}{% endblock %}
{# Card #}
<div id="{{ _id }}" class="card mb-{{ _margin_bottom }} {% block box_class %}{% endblock %}" {% block box_attributes %}{% endblock %}>

    {# Card Status #}
    {% if _boxtype is not null %}
        <div class="card-status-{{ _status_position }} bg-{{ _boxtype }}"></div>
    {% endif %}

    {# Header #}
    {% block box_header_before %}{% endblock %}
    {% if _title is not null or _collapsible or _tools is not null or _header is not null %}
        <div class="card-header {% block box_header_class %}{% endblock %}">
            {% if _header is not null %}
                {{ _header|raw }}
            {% else %}
                {% if _title is not null %}<h3 class="card-title">{{ _title|raw }}</h3>{% endif %}
                <div class="card-actions" {% block box_tools_attributes %}{% endblock %}>
                    {# Buttons, labels, and many other things can be placed here! #}
                    {% if _tools is not null %}{{ _tools|raw }}{% endif %}
                    {% if _collapsible %}
                        {{ button.action_collapsebutton(
                            collapsible_title|default('Toggle visibility'|trans({}, 'TablerBundle')),
                            '.' ~ _collapsible_class
                        ) }}
                    {% endif %}
                </div>
            {% endif %}
        </div>
    {% endif %}
    {% block box_header_after %}{% endblock %}

    {# Body #}
    {% block box_body_before %}{% endblock %}
    <div class="card-body {% if _fullsize %}p-0{% endif %} {% if _collapsible %} {{ _collapsible_class ~ (_collapsed ? ' collapse' : ' show') }} {% endif %} {% block box_body_class %}{% endblock %}">
        {% block box_body %}{% endblock %}
    </div>
    {% block box_body_after %}{% endblock %}

    {# Footer #}
    {% block box_footer_before %}{% endblock %}
    {% if _footer %}
        <div class="card-footer {% if _footer_collapsible %} {{ _collapsible_class ~ (_collapsed ? ' collapse' : ' show') }} {% endif %} {% block box_footer_class %}{% endblock %}">
            {% block box_footer %}{% endblock %}
        </div>
    {% endif %}
    {% block box_footer_after %}{% endblock %}

</div>
{% block box_after %}{% endblock %}
