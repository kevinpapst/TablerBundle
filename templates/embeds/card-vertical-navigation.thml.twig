{# {% extends "@Tabler/embeds/card.html.twig" %} #}

{% set keyActive = null %}

{% set _items = [] %}
{% for key, item in items %}
    {% if item.active ?? false %}
        {% set keyActive = key %}
    {% endif %}

    {% if item.id is not defined %}
        {% set item = item|merge({id : random(999999)}) %}
    {% endif %}
    {% set _items = _items|merge({ (key) : item }) %}
{% endfor %}

{% set autoActive = keyActive is null %}

{% block card_before %}{% endblock %}
<div class="card {% block card_class %}mb-3{% endblock %}">
    <div class="row g-0">

        {# Nav items #}
        {% block nav_before %}{% endblock %}
        <div class="{% block nav_size %}col-3{% endblock %} border-end {% block nav_display %}d-none d-md-block{% endblock %}">
            <div class="card-body">
                <div class="list-group {% block nav_list_class %}list-group-transparent{% endblock %}">
                    {% for key, item in _items %}
                        {% if item.header ?? false %}
                            <h4 class="subheader {% block nav_header_class %}mx-4 mt-3{% endblock %}">{{ item.name }}</h4>
                        {% else %}
                            {% set url = item.url ?? ("#tabs-" ~ item.id) %}
                            <a
                                    href="{{ url }}"
                                    class="list-group-item list-group-item-action d-flex align-items-center {% if (autoActive and loop.first) or keyActive is same as key %}active{% endif %}"
                                    {% if item.url is not defined and not block('content') is defined %}data-bs-toggle="tab"{% endif %}
                            >
                                {% if item.raw ?? false %}
                                    {{ item.name | raw }}
                                {% else %}
                                    {{ item.name }}
                                {% endif %}
                            </a>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
        {% block nav_after %}{% endblock %}

        {# Content #}
        {% block content_before %}{% endblock %}
        <div class="{% block content_size %}col{% endblock %} {% block content_display %}d-flex flex-column{% endblock %}">
            <div class="card-body">
                {% if block('content') is defined %}
                    {{ block('content') }}
                {% else %}
                    <div class="tab-content">
                        {% for key, item in _items %}
                            {% if item.content is defined and not item.header ?? false %}
                                <div class="tab-pane {% if (autoActive and loop.first) or keyActive is same as key %}active show{% endif %}"
                                     id="tabs-{{ item.id }}"
                                     {% if item.url is not defined %}role="tabpanel"{% endif %}
                                >
                                    {{ item.content|raw }}
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        </div>
        {% block content_after %}{% endblock %}

    </div>
</div>
{% block card_after %}{% endblock %}
